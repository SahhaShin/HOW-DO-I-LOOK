## ğŸ“Œ Project Skill Stack Version

</br></br>

| Skill | Version | 
|:----------|:----------:|
| **Java** | 11 | 
| **SpringBoot** | 2.7.14 |
| **MySQL** | 8.0.33 | 
| **Redis** | 3.0.504 |
| **Node.js** | 14.21.3 |
| **NPM** | 6.14.18 |

</br></br>

## ğŸ“Œ EC2 í¬íŠ¸ ë²ˆí˜¸

| Skill | Port | 
|:----------|:----------:|
| **Back** | 8081 | 
| **Front** | 3000 |
| **MySQL** | 3306 | 
| **Redis** | 6000 |
| **Nginx** | 80/443 |
| **OpenVidu** | 8443 |

</br></br>

## ğŸ“Œ ì™¸ë¶€ í”„ë¡œê·¸ë¨

</br></br>

#### OpenVidu

</br></br>

#### ê¸°ìƒì²­ ë‚ ì”¨ API

</br></br>

#### remBG

</br></br>

## ğŸ“Œ ë¹Œë“œ ë°©ë²•

</br></br>

### 1. ë°±ì—”ë“œ

IntelliJ ìš°ì¸¡ì˜ ì½”ë¼ë¦¬ ëª¨ì–‘ ë²„íŠ¼ (Gradle) í´ë¦­

![](https://velog.velcdn.com/images/yun12343/post/22d2f7dc-6775-429a-9df8-0786746fc1e9/image.png)

</br></br>

### 2. í”„ë¡ íŠ¸ì—”ë“œ

```bash
npm install --force

npm run build
```

</br></br>

## ğŸ“Œ EC2 Setting

</br></br>

### 0. ê¸°ë³¸ì ìœ¼ë¡œ ìœ„ì˜ ì„¸íŒ…ì„ ì°¸ê³ í•˜ì—¬ í•„ìš”í•œ íŒ¨í‚¤ì§€, í”„ë¡œê·¸ë¨ì„ ECì— ë‹¤ìš´ë¡œë“œ ë°›ì•˜ë‹¤ëŠ” ê°€ì • í•˜ì— ì§„í–‰
	- Docker, Docker-Compose, Nginx, MySQL, Java ë“±

</br></br>

### 1. ë„ì»¤ ì´ë¯¸ì§€ pull (redisì˜ ê²½ìš°, ê¸°ë³¸ redisê°€ ì œê³µí•˜ëŠ” ì´ë¯¸ì§€ì´ë¯€ë¡œ ê°ì ë‹¤ìš´ë°›ì•„ë„ë¨.)

```bash
docker pull parkseyun/howdoilook:front
docker pull parkseyun/howdoilook:back
docker pull parkseyun/howdoilook:redis
```

</br></br>

### 2. EC2 ì„œë²„ì—ì„œ gitlab í”„ë¡œì íŠ¸ í´ë¡ 

```bash
git clone -b main https://lab.ssafy.com/s09-webmobile1-sub2/S09P12B304.git
```

</br></br>

### 3. application.properties, .env íŒŒì¼ ì„¸íŒ…

```bash
cd /home/ubuntu/S09P12B304/Back/src/main/resources

sudo vim application.properties
```
- í•´ë‹¹ ìœ„ì¹˜ì— application.properties ìƒì„± (ì¤‘ìš” ì •ë³´ ìƒëµ)
```properties
server.port=8081
server.tomcat.allowed-origins=*


# Swagger 3.0.0 Setting
spring.mvc.pathmatch.matching-strategy = ant_path_matcher

spring.datasource.driver-class-name = com.mysql.cj.jdbc.Driver
spring.datasource.url = jdbc:mysql://{ë°°í¬ MYSQL ì£¼ì†Œ}?serverTimezone=Asia/Seoul
spring.datasource.username = {MySQL Username}
spring.datasource.password = {MySQL ë¹„ë°€ë²ˆí˜¸}

spring.jpa.hibernate.ddl-auto = none
spring.jpa.hibernate.naming.physical-strategy = org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.show-sql = true

# JWT

jwt.secretKey = {JWT SecretKey}

# accessToken :
jwt.access.expiration = 3600000
jwt.access.header = Authorization

# refreshToken :
jwt.refresh.expiration = 1209600000
jwt.refresh.header = Authorization-Refresh

# Redis
spring.redis.host = {Redis Host}
spring.redis.port = 6000

# Google
spring.security.oauth2.client.registration.google.client-id = {Google Client Id}
spring.security.oauth2.client.registration.google.client-secret = {Google Client Secret}
spring.security.oauth2.client.registration.google.scope = profile, email
spring.security.oauth2.client.registration.google.redirect-uri = {Google Redirect URI}

# Naver
spring.security.oauth2.client.registration.naver.client-id = {Naver Client Id}
spring.security.oauth2.client.registration.naver.client-secret = {Naver Client Secret}
spring.security.oauth2.client.registration.naver.client-name = Naver
spring.security.oauth2.client.registration.naver.authorization-grant-type = authorization_code
spring.security.oauth2.client.registration.naver.scope = name, email, profile_image
spring.security.oauth2.client.registration.naver.redirect-uri = {Naver Redirect URI}


# Naver Provider
spring.security.oauth2.client.provider.naver.authorization-uri = https://nid.naver.com/oauth2.0/authorize
spring.security.oauth2.client.provider.naver.token-uri = https://nid.naver.com/oauth2.0/token
spring.security.oauth2.client.provider.naver.user-info-uri = https://openapi.naver.com/v1/nid/me
spring.security.oauth2.client.provider.naver.user-name-attribute = response


# Kakao
spring.security.oauth2.client.registration.kakao.client-id = {Kakao Client Id}
spring.security.oauth2.client.registration.kakao.client-secret = {Kakao Client Secret}
spring.security.oauth2.client.registration.kakao.client-name = Kakao
spring.security.oauth2.client.registration.kakao.client-authentication-method = POST
spring.security.oauth2.client.registration.kakao.authorization-grant-type = authorization_code
spring.security.oauth2.client.registration.kakao.scope = profile_nickname, profile_image
spring.security.oauth2.client.registration.kakao.redirect-uri = {Kakao Redirect URI}


# Kakao Provider
spring.security.oauth2.client.provider.kakao.authorization-uri = https://kauth.kakao.com/oauth/authorize
spring.security.oauth2.client.provider.kakao.token-uri = https://kauth.kakao.com/oauth/token
spring.security.oauth2.client.provider.kakao.user-info-uri = https://kapi.kakao.com/v2/user/me
spring.security.oauth2.client.provider.kakao.user-name-attribute = id

# Cloud AWS S3 Configuration
cloud.aws.s3.bucket={AWS S3 Bucket Name}

# AWS Credentials
cloud.aws.credentials.access-key={AWS Access Key}
cloud.aws.credentials.secret-key={AWS Secret Key}

# AWS Region
cloud.aws.region.static=ap-northeast-2
cloud.aws.region.auto=false

# AWS Stack
cloud.aws.stack.auto=false

# OpenVidu
server.ssl.enabled: false
OPENVIDU_URL: https://howdoilook-streaming.shop:8443
OPENVIDU_SECRET: {OpenVidu Secret Code}

#Mongo DB setup
spring.data.mongodb.uri={mongoDB Cloud ìœ„ì¹˜}

python.file.path=/home/ubuntu/S09P12B304/RemoveImageBg.py
```

</br>

```bash
cd /home/ubuntu/S09P12B304/front
sudo vim .env
```

```bash
# ì•ì— REACT_APPì„ ê¼­ ë¶™ì—¬ì¤˜ì•¼ ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ë³€ìˆ˜ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.
REACT_APP_KAKAO_REVERSEGEO="{ì¹´ì¹´ì˜¤ìœ„ì¹˜APIKey}"
REACT_APP_WEATHER="{ë‚ ì”¨APIKey}"

# ë°±ì—”ë“œ ìš”ì²­ ê³µí†µ url -- local
REACT_APP_SERVER="https://i9b304.p.ssafy.io"

# í”„ë¡ íŠ¸ ë¡œì»¬ ìš”ì²­ ê³µí†µ url -- local
REACT_APP_FRONT="https://i9b304.p.ssafy.io"


#OPENVIDU ìš”ì²­ ê³µí†µ url -- local 
REACT_APP_OPENVIDU = "https://i9b304.p.ssafy.io"

```

</br></br>


4. nginx ì„¸íŒ…

```bash
cd /etc/nginx/sites-available

sudo vim configure
```

- í•´ë‹¹ ìœ„ì¹˜ì— nginx ì„¤ì • íŒŒì¼ ìƒì„±

```
server {
        listen 443 ssl;

        server_name i9b304.p.ssafy.io;

        ssl_certificate /etc/letsencrypt/live/i9b304.p.ssafy.io/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/i9b304.p.ssafy.io/privkey.pem;

        location / {

                proxy_pass http://localhost:3000;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;

        }
        location /login {

                proxy_pass http://localhost:8081/login;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
        }
        location /api {

                proxy_pass http://localhost:8081/api;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;

        }
        location /redis {
            proxy_pass http://localhost:6000;
            proxy_set_header Host $host;
        }
        location /ws {
            proxy_pass http://localhost:8081;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header Origin "";
        }
        location /wss {
            proxy_pass http://localhost:8081;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header Origin "";
        }
}

server {
        if ($host = i9b304.p.ssafy.io) {
                return 301 https://$host$request_uri;
        }

        listen 80;
        server_name i9b304.p.ssafy.io;
        return 404;
}
```

- ìƒì„±í•œ ì„¤ì • íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½

```
sudo ln -s /etc/nginx/sites-available/configure /etc/nginx/sites-enabled/configure

sudo nginx -t   # okì‹œ ì„±ê³µ

sudo systemctl restart nginx
```

</br></br>

### 5. NVMì„ í™œìš©í•œ node, npm ë²„ì „ ì„¸íŒ…

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash

export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"

[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

nvm install 14.21.3

nvm run node --14.21.3
```

</br></br>

### 6. í”„ë¡ íŠ¸(Nginxí™œìš©) ë°°í¬

> letsencryptë¥¼ í™œìš©í•œ ì¸ì¦ì„œëŠ” ì‚¬ì „ì— ë°œê¸‰ ë°›ì•˜ë‹¤ê³  ê°€ì •

```bash
# front í´ë” ë‚´ë¶€ ìœ„ì¹˜ì—ì„œ ì§„í–‰ (nginx íŒŒì¼ì´ ìˆëŠ” ê³³)

npm install --force
npm run build   # í•´ë‹¹ ìœ„ì¹˜ì— build í´ë”ê°€ ìƒê²¼ëŠ”ì§€ í™•ì¸í•œë‹¤.

docker build -t parkseyun/howdoilook:front
docker run --name front -d -p 3000:80 parkseyun/howdoilook:front
```

</br></br>

### 7. ë°±ì—”ë“œ / ë ˆë””ìŠ¤ ë°°í¬

```bash
# front, backê³¼ ê°™ì€ ìœ„ì¹˜(docker-compose.yml íŒŒì¼ì´ ìˆëŠ”ê³³)ì—ì„œ ì§„í–‰

docker-compose up -d back redis
```